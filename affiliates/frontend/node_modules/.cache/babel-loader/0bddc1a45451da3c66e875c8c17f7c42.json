{"ast":null,"code":"import _classCallCheck from \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/src/containers/LearnEdit/LearnEdit.js\";\nimport React from 'react';\nimport axios from '../../lovecodeaxios';\nimport withErrorHandler from '../../hoc/withErrorHandler/withErrorHandler';\nimport { DEFAULT_LEARN_CONTENT } from '../../extras/Constants/Constants';\nimport { withRouter } from \"react-router\";\nimport getCookie from '../../utils/getCookie';\nimport LearnEditEditor from './LearnEditEditor';\nimport LearnPreview from \"./LearnPreview\";\nimport Dialog from '@material-ui/core/Dialog';\nimport Slide from '@material-ui/core/Slide';\nimport Typography from '@material-ui/core/Typography';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport { withStyles } from '@material-ui/core/styles';\nimport getParsedContent from '../../utils/getParsedContent';\nimport BasicMetaTags from '../../components/MetaTags/BasicMetaTags';\nimport { animateScroll as scroll } from 'react-scroll';\nvar styles = {\n  appBar: {\n    position: 'relative'\n  },\n  flex: {\n    flex: 1\n  }\n};\n\nvar resetTimeout = function resetTimeout(id, newID) {\n  clearTimeout(id);\n  return newID;\n};\n\nvar Transition = React.forwardRef(function Transition(props, ref) {\n  return React.createElement(Slide, Object.assign({\n    direction: \"up\",\n    ref: ref\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37\n    },\n    __self: this\n  }));\n});\n\nvar LearnEdit =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LearnEdit, _React$Component);\n\n  function LearnEdit(props) {\n    var _this;\n\n    _classCallCheck(this, LearnEdit);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LearnEdit).call(this, props));\n\n    _this.toggleCommitPanel = function () {\n      _this.setState(function (prevState) {\n        return {\n          showCommitPanel: !prevState.showCommitPanel\n        };\n      });\n\n      scroll.scrollToBottom();\n    };\n\n    _this.saveLearnMd = function () {\n      var csrftoken = getCookie('csrftoken');\n      var postData = {\n        tutorial_id: _this.state.tutorialId,\n        content: _this.state.editorContent,\n        tutorial_slug: _this.state.tutorialSlug,\n        tutorial_data: _this.state.tutorialData,\n        tags: _this.state.tags\n      };\n\n      _this.setState({\n        loading: true\n      });\n\n      axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n      axios.post('/tutorials/save', postData).then(function (response) {\n        _this.setState({\n          loading: false,\n          dbData: response.data,\n          isPublished: response.data ? response.data.is_published : false\n        });\n      }).catch(function (error) {\n        console.log(error);\n\n        _this.setState({\n          loading: false,\n          error: error\n        });\n      });\n    };\n\n    _this.publishUnpublishTut = function () {\n      if (_this.state.dbData) {\n        var putData = {\n          id: _this.state.dbData.id,\n          is_published: !_this.state.isPublished\n        };\n\n        _this.setState({\n          loading: true\n        });\n\n        var csrftoken = getCookie('csrftoken');\n        axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n        axios.put('/tutorials/' + _this.state.dbData.id + '/publish', putData).then(function (response) {\n          _this.setState({\n            isPublished: response.data.is_published,\n            loading: false\n          });\n        }).catch(function (error) {\n          _this.setState({\n            error: error\n          });\n        });\n      }\n    };\n\n    _this.togglePreview = function () {\n      _this.setState(function (prevState) {\n        return {\n          showPreview: !prevState.showPreview\n        };\n      });\n    };\n\n    _this.learnContentUpdate = function (value) {\n      _this.setState(function (prevState, props) {\n        return {\n          editorContent: value,\n          tutorialData: getParsedContent(value),\n          timeout: resetTimeout(prevState.timeout, setTimeout(_this.saveLearnMd, 1200))\n        };\n      });\n    };\n\n    _this.handleDeleteStory = function () {\n      var csrftoken = getCookie('csrftoken');\n      axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n      axios.delete('/tutorials/' + _this.state.tutorialId).then(function (response) {\n        console.log(response.data);\n\n        _this.props.history.push(\"/stories\");\n      }).catch(function (error) {\n        _this.setState({\n          error: error\n        });\n      });\n    };\n\n    _this.commitMessageUpdate = function (event) {\n      _this.setState({\n        commitMessage: event.target.value\n      });\n    };\n\n    _this.handleBranchChange = function (event) {\n      var tutorialSlug = _this.props.match.params.tutorialSlug;\n\n      _this.props.history.push('/story/create/' + _this.state.repoName + '/' + _this.state.tutorialId + \"/\" + tutorialSlug + \"/\" + event.target.value);\n    };\n\n    _this.setTags = function (value) {\n      _this.setState(function (prevState, props) {\n        return {\n          tags: value,\n          timeout: resetTimeout(prevState.timeout, setTimeout(_this.saveLearnMd, 1200))\n        };\n      });\n    };\n\n    _this.fetchLearnContent = function () {\n      _this.setState({\n        loading: true\n      });\n\n      axios.get('/learn/content/' + _this.state.tutorialId).then(function (response) {\n        var editorContent = response.data.db_data ? response.data.db_data.learn_md_content ? response.data.db_data.learn_md_content : DEFAULT_LEARN_CONTENT : DEFAULT_LEARN_CONTENT;\n\n        _this.setState({\n          loading: false,\n          editorContent: editorContent,\n          tutorialData: getParsedContent(editorContent),\n          sha: response.data.sha,\n          hasDefaultContent: response.data.db_data ? response.data.db_data.learn_md_content ? false : true : true,\n          contentLoaded: true,\n          dbData: response.data.db_data,\n          tags: response.data.db_data ? response.data.db_data.tutorial_tags : [],\n          tutorialTitle: response.data.db_data.title,\n          isPublished: response.data.db_data ? response.data.db_data.is_published : false\n        });\n      }).catch(function (error) {\n        _this.setState({\n          error: error\n        });\n      });\n    };\n\n    var repoName = _this.props.match.params.repoName;\n    var tutorialId = _this.props.match.params.tutorialId;\n    var branchName = _this.props.match.params.branchName;\n    var _tutorialSlug = _this.props.match.params.tutorialSlug;\n    _this.state = {\n      editorContent: \"\",\n      branchName: branchName,\n      repoName: repoName,\n      tutorialId: tutorialId,\n      error: null,\n      hasDefaultContent: false,\n      sha: null,\n      commitMessage: \"Updated learn.md\",\n      timeout: null,\n      isPublished: false,\n      dbData: null,\n      loading: true,\n      showCommitPanel: false,\n      showPreview: false,\n      tutorialSlug: _tutorialSlug,\n      tutorialData: \"\",\n      tags: []\n    };\n    return _this;\n  }\n\n  _createClass(LearnEdit, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this2 = this;\n\n      var newBranchName = this.props.match.params.branchName;\n      var prevBranchName = prevProps.match.params.branchName;\n\n      if (prevBranchName !== newBranchName) {\n        this.setState({\n          branchName: newBranchName\n        }, function () {\n          return _this2.fetchLearnContent();\n        });\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchLearnContent();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var classes = this.props;\n      return React.createElement(React.Fragment, null, React.createElement(BasicMetaTags, {\n        title: \"Create your story\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }), React.createElement(Dialog, {\n        fullScreen: true,\n        open: this.state.showPreview,\n        onClose: this.togglePreview,\n        TransitionComponent: Transition,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(AppBar, {\n        className: classes.appBar,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, React.createElement(Toolbar, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(IconButton, {\n        color: \"inherit\",\n        onClick: this.togglePreview,\n        \"aria-label\": \"Close\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(CloseIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      })), React.createElement(Typography, {\n        variant: \"h6\",\n        color: \"inherit\",\n        className: classes.flex,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, this.state.tutorialTitle))), React.createElement(LearnPreview, {\n        content: this.state.tutorialData,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      })), React.createElement(LearnEditEditor, Object.assign({}, this.state, {\n        handleBranchChange: this.handleBranchChange,\n        publishUnpublishTut: this.publishUnpublishTut,\n        learnContentUpdate: this.learnContentUpdate,\n        commitMessageUpdate: this.commitMessageUpdate,\n        fetchLearnContent: this.fetchLearnContent,\n        toggleCommitPanel: this.toggleCommitPanel,\n        togglePreview: this.togglePreview,\n        handleDeleteStory: this.handleDeleteStory,\n        setTags: this.setTags,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return LearnEdit;\n}(React.Component);\n\nexport default withErrorHandler(withRouter(withStyles(styles)(LearnEdit)), axios, \"circular\");","map":{"version":3,"sources":["/home/shahrukh/Code/projects/allywith/Codeilm.com/lovecode/lovecodefrontend/lovecode/src/containers/LearnEdit/LearnEdit.js"],"names":["React","axios","withErrorHandler","DEFAULT_LEARN_CONTENT","withRouter","getCookie","LearnEditEditor","LearnPreview","Dialog","Slide","Typography","IconButton","CloseIcon","AppBar","Toolbar","withStyles","getParsedContent","BasicMetaTags","animateScroll","scroll","styles","appBar","position","flex","resetTimeout","id","newID","clearTimeout","Transition","forwardRef","props","ref","LearnEdit","toggleCommitPanel","setState","prevState","showCommitPanel","scrollToBottom","saveLearnMd","csrftoken","postData","tutorial_id","state","tutorialId","content","editorContent","tutorial_slug","tutorialSlug","tutorial_data","tutorialData","tags","loading","defaults","headers","common","post","then","response","dbData","data","isPublished","is_published","catch","error","console","log","publishUnpublishTut","putData","put","togglePreview","showPreview","learnContentUpdate","value","timeout","setTimeout","handleDeleteStory","delete","history","push","commitMessageUpdate","event","commitMessage","target","handleBranchChange","match","params","repoName","setTags","fetchLearnContent","get","db_data","learn_md_content","sha","hasDefaultContent","contentLoaded","tutorial_tags","tutorialTitle","title","branchName","prevProps","newBranchName","prevBranchName","classes","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from '../../lovecodeaxios'\nimport withErrorHandler from '../../hoc/withErrorHandler/withErrorHandler'\nimport { DEFAULT_LEARN_CONTENT } from '../../extras/Constants/Constants'\nimport { withRouter } from \"react-router\";\nimport getCookie from '../../utils/getCookie'\nimport LearnEditEditor from './LearnEditEditor'\nimport LearnPreview from \"./LearnPreview\"\nimport Dialog from '@material-ui/core/Dialog';\nimport Slide from '@material-ui/core/Slide';\nimport Typography from '@material-ui/core/Typography';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport { withStyles } from '@material-ui/core/styles';\nimport getParsedContent from '../../utils/getParsedContent';\nimport BasicMetaTags from '../../components/MetaTags/BasicMetaTags'\nimport { animateScroll as scroll } from 'react-scroll'\n\n\nconst styles = {\n  appBar: {\n    position: 'relative',\n  },\n  flex: {\n    flex: 1,\n  },\n};\n\nconst resetTimeout = (id, newID) => {\n\tclearTimeout(id)\n\treturn newID\n}\n\nconst Transition = React.forwardRef(function Transition(props, ref) {\n  return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\n\nclass LearnEdit extends React.Component {\n\n  constructor(props) {\n\n    super(props)\n    const { repoName } = this.props.match.params;\n    const { tutorialId } = this.props.match.params;\n    const { branchName } = this.props.match.params;\n\t\tconst { tutorialSlug } = this.props.match.params;\n\n    this.state = {\n      editorContent: \"\",\n      branchName: branchName,\n      repoName: repoName,\n      tutorialId: tutorialId,\n      error: null,\n      hasDefaultContent: false,\n      sha: null,\n      commitMessage: \"Updated learn.md\",\n      timeout: null,\n      isPublished: false,\n      dbData: null,\n      loading: true,\n      showCommitPanel: false,\n\t\t\tshowPreview: false,\n\t\t\ttutorialSlug: tutorialSlug,\n      tutorialData: \"\",\n      tags: []\n    }\n  }\n\n  toggleCommitPanel = () => {\n    this.setState(prevState => {\n      return { showCommitPanel: !prevState.showCommitPanel }\n    })\n    scroll.scrollToBottom();\n  }\n\n  saveLearnMd = () => {\n\n    const csrftoken = getCookie('csrftoken');\n    const postData = {\n      tutorial_id: this.state.tutorialId,\n      content: this.state.editorContent,\n\t\t\ttutorial_slug: this.state.tutorialSlug,\n      tutorial_data: this.state.tutorialData,\n      tags: this.state.tags\n    };\n    this.setState({loading: true})\n    axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n    axios.post('/tutorials/save', postData)\n    .then(response => {\n      this.setState({\n        loading: false,\n        dbData: response.data,\n        isPublished: response.data ? response.data.is_published : false,\n      })\n    })\n    .catch(error => {\n      console.log(error);\n      this.setState({\n        loading: false,\n        error: error\n      })\n    })\n\n  }\n\n  publishUnpublishTut = () => {\n    if(this.state.dbData) {\n      let putData = {\n        id: this.state.dbData.id,\n        is_published: !this.state.isPublished\n      }\n      this.setState({loading: true})\n      const csrftoken = getCookie('csrftoken');\n\n      axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n      axios.put('/tutorials/' + this.state.dbData.id + '/publish', putData)\n      .then(response => {\n        this.setState({isPublished: response.data.is_published, loading: false})\n      })\n      .catch(error => {\n        this.setState({\n          error: error,\n        })\n      })\n\n    }\n  }\n\n\ttogglePreview = () => {\n\t\tthis.setState(prevState => {\n\t\t\treturn {showPreview: !prevState.showPreview}\n\t\t})\n\t}\n\n  componentDidUpdate(prevProps) {\n    const newBranchName = this.props.match.params.branchName;\n    const prevBranchName = prevProps.match.params.branchName;\n\n    if(prevBranchName !== newBranchName) {\n      this.setState({branchName: newBranchName}, () => this.fetchLearnContent())\n    }\n  }\n\n  learnContentUpdate = value => {\n    this.setState((prevState, props) => {\n      return {\n        editorContent: value,\n        tutorialData: getParsedContent(value),\n        timeout: resetTimeout(prevState.timeout, setTimeout(this.saveLearnMd, 1200))\n      }\n    })\n  }\n\n  handleDeleteStory = () => {\n      const csrftoken = getCookie('csrftoken');\n\n      axios.defaults.headers.common['X-CSRFToken'] = csrftoken;\n      axios.delete('/tutorials/' + this.state.tutorialId)\n      .then(response => {\n        console.log(response.data);\n        this.props.history.push(\"/stories\")\n      })\n      .catch(error => {\n        this.setState({\n          error: error,\n        })\n      })\n  }\n\n  commitMessageUpdate = event => {\n    this.setState({commitMessage: event.target.value})\n  }\n\n  handleBranchChange = event => {\n    const { tutorialSlug } = this.props.match.params\n    this.props.history.push('/story/create/' + this.state.repoName + '/' + this.state.tutorialId + \"/\" + tutorialSlug + \"/\" + event.target.value);\n  }\n\n  setTags = value => {\n    this.setState((prevState, props) => {\n      return {\n        tags: value,\n        timeout: resetTimeout(prevState.timeout, setTimeout(this.saveLearnMd, 1200))\n      }\n    })\n  }\n\n  fetchLearnContent = () => {\n    this.setState({loading: true})\n    axios.get('/learn/content/' + this.state.tutorialId)\n    .then(response => {\n      const editorContent = response.data.db_data ? response.data.db_data.learn_md_content ? response.data.db_data.learn_md_content : DEFAULT_LEARN_CONTENT : DEFAULT_LEARN_CONTENT;\n      this.setState({\n        loading: false,\n        editorContent: editorContent,\n        tutorialData: getParsedContent(editorContent),\n        sha: response.data.sha,\n        hasDefaultContent: response.data.db_data ? response.data.db_data.learn_md_content ? false : true : true,\n        contentLoaded: true,\n        dbData: response.data.db_data,\n        tags: response.data.db_data ? response.data.db_data.tutorial_tags : [],\n\t\t\t\ttutorialTitle: response.data.db_data.title,\n        isPublished: response.data.db_data ? response.data.db_data.is_published : false\n      })\n    })\n    .catch(error => {\n      this.setState({\n        error: error,\n      })\n    })\n\n  }\n\n  componentDidMount() {\n    this.fetchLearnContent()\n  }\n\n  render() {\n\t\tconst classes = this.props\n    return (\n\t\t\t<>\n      <BasicMetaTags title=\"Create your story\" />\n\t\t\t<Dialog\n\t\t\t\tfullScreen\n\t\t\t\topen={this.state.showPreview}\n\t\t\t\tonClose={this.togglePreview}\n\t\t\t\tTransitionComponent={Transition}\n\t\t\t>\n\t\t\t<AppBar className={classes.appBar}>\n        <Toolbar>\n          <IconButton color=\"inherit\" onClick={this.togglePreview} aria-label=\"Close\">\n            <CloseIcon />\n          </IconButton>\n          <Typography variant=\"h6\" color=\"inherit\" className={classes.flex}>\n            {this.state.tutorialTitle}\n          </Typography>\n        </Toolbar>\n      </AppBar>\n\t\t\t\t<LearnPreview  content={this.state.tutorialData}/>\n\t\t\t</Dialog>\n\t\t\t\t<LearnEditEditor\n\t\t\t\t{...this.state}\n\t\t\t\thandleBranchChange={this.handleBranchChange}\n\t\t\t\tpublishUnpublishTut={this.publishUnpublishTut}\n\t\t\t\tlearnContentUpdate={this.learnContentUpdate}\n\t\t\t\tcommitMessageUpdate={this.commitMessageUpdate}\n\t\t\t\tfetchLearnContent={this.fetchLearnContent}\n\t\t\t\ttoggleCommitPanel={this.toggleCommitPanel}\n\t\t\t\ttogglePreview={this.togglePreview}\n        handleDeleteStory={this.handleDeleteStory}\n        setTags={this.setTags}\n\t\t\t\t/>\n\n\t\t\t\t</>\n    )\n  }\n}\n\nexport default withErrorHandler(withRouter(withStyles(styles)(LearnEdit)), axios, \"circular\")\n"]},"metadata":{},"sourceType":"module"}