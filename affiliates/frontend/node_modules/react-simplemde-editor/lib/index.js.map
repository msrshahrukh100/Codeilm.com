{"version":3,"sources":["../src/index.tsx"],"names":["noop","_id","generateId","SimpleMDEEditor","props","state","keyChange","value","id","simpleMde","editorEl","editorToolbarEl","createEditor","SimpleMDE","require","initialOptions","element","document","getElementById","initialValue","allOptions","Object","assign","options","eventWrapper","setState","onChange","removeEvents","removeEventListener","addEvents","elementWrapperRef","getElementsByClassName","addEventListener","codemirror","on","getCursor","events","entries","forEach","eventName","callback","getLineAndCursor","getDoc","getMdeInstance","addExtraKeys","extraKeys","setOption","setElementWrapperRef","window","undefined","prevProps","children","label","rest","React","PureComponent","defaultProps"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport * as SimpleMDE from \"easymde\";\nimport { KeyMap, DOMEvent, Editor } from \"codemirror\";\n\nconst noop = () => {};\nlet _id = 0;\n\nconst generateId = () => `simplemde-editor-${++_id}`;\n\ntype CodemirrorEvents =\n  | \"change\"\n  | \"changes\"\n  | \"beforeChange\"\n  | \"cursorActivity\"\n  | \"beforeSelectionChange\"\n  | \"viewportChange\"\n  | \"gutterClick\"\n  | \"focus\"\n  | \"blur\"\n  | \"scroll\"\n  | \"update\"\n  | \"renderLine\";\n\ntype SimpleMdeToCodemirror = {\n  [E in CodemirrorEvents | DOMEvent]: Editor[\"on\"]\n};\n\nexport interface SimpleMDEEditorProps {\n  id?: string;\n  label?: string;\n  onChange: (value: string) => void | any;\n  value?: string;\n  className?: string;\n  extraKeys?: KeyMap;\n  options?: SimpleMDE.Options;\n  events?: SimpleMdeToCodemirror;\n  getMdeInstance?: (instance: SimpleMDE) => void | any;\n  getLineAndCursor?: (position: CodeMirror.Position) => void | any;\n}\n\ntype SimpleMDEEditorState = {\n  keyChange: boolean;\n  value: string;\n};\n\nexport default class SimpleMDEEditor extends React.PureComponent<\n  SimpleMDEEditorProps,\n  SimpleMDEEditorState\n> {\n  private elementWrapperRef: HTMLDivElement | null;\n  private setElementWrapperRef: (element: HTMLDivElement) => void;\n\n  static defaultProps = {\n    events: {},\n    onChange: noop,\n    options: {}\n  };\n\n  state = {\n    keyChange: false,\n    value: this.props.value || \"\"\n  };\n\n  id = this.props.id ? this.props.id : generateId();\n  simpleMde: SimpleMDE | null = null;\n  editorEl: HTMLDivElement | null = null;\n  editorToolbarEl: Element | null = null;\n\n  constructor(props: SimpleMDEEditorProps) {\n    super(props);\n    this.elementWrapperRef = null;\n    this.setElementWrapperRef = (element: HTMLDivElement) => {\n      this.elementWrapperRef = element;\n    };\n  }\n\n  componentDidMount() {\n    if (typeof window !== undefined) {\n      this.createEditor();\n      this.addEvents();\n      this.addExtraKeys();\n      this.getCursor();\n      this.getMdeInstance();\n    }\n  }\n\n  componentDidUpdate(prevProps: SimpleMDEEditorProps) {\n    if (\n      !this.state.keyChange &&\n      this.props.value !== this.state.value && // This is somehow fixes moving cursor for controlled case\n      this.props.value !== prevProps.value // This one fixes no value change for uncontrolled input. If it's uncontrolled prevProps will be the same\n    ) {\n      this.simpleMde!.value(this.props.value || \"\");\n    }\n    this.setState({\n      keyChange: false\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.editorEl !== null && this.editorEl !== undefined) {\n      this.removeEvents();\n    }\n  }\n\n  createEditor = () => {\n    const SimpleMDE = require(\"easymde\");\n    const initialOptions = {\n      element: document.getElementById(this.id),\n      initialValue: this.props.value\n    };\n\n    const allOptions = Object.assign({}, initialOptions, this.props.options);\n    this.simpleMde = new SimpleMDE(allOptions);\n  };\n\n  eventWrapper = () => {\n    this.setState({\n      keyChange: true,\n      value: this.simpleMde!.value()\n    });\n    this.props.onChange(this.simpleMde!.value());\n  };\n\n  removeEvents = () => {\n    if (this.editorEl && this.editorToolbarEl) {\n      this.editorEl.removeEventListener(\"keyup\", this.eventWrapper);\n      this.editorEl.removeEventListener(\"paste\", this.eventWrapper);\n      this.editorToolbarEl.removeEventListener(\"click\", this.eventWrapper);\n    }\n  };\n\n  addEvents = () => {\n    if (this.elementWrapperRef && this.simpleMde) {\n      this.editorEl = this.elementWrapperRef;\n      this.editorToolbarEl = this.elementWrapperRef.getElementsByClassName(\n        \"editor-toolbar\"\n      )[0];\n\n      this.editorEl.addEventListener(\"keyup\", this.eventWrapper);\n      this.editorEl.addEventListener(\"paste\", this.eventWrapper);\n      this.editorToolbarEl &&\n        this.editorToolbarEl.addEventListener(\"click\", this.eventWrapper);\n\n      this.simpleMde.codemirror.on(\"cursorActivity\", this.getCursor);\n\n      const { events } = this.props;\n\n      // Handle custom events\n      events &&\n        Object.entries(events).forEach(([eventName, callback]) => {\n          if (eventName && callback) {\n            this.simpleMde &&\n              this.simpleMde.codemirror.on(\n                eventName as DOMEvent,\n                callback as any\n              );\n          }\n        });\n    }\n  };\n\n  getCursor = () => {\n    // https://codemirror.net/doc/manual.html#api_selection\n    if (this.props.getLineAndCursor) {\n      this.props.getLineAndCursor(\n        this.simpleMde!.codemirror.getDoc().getCursor()\n      );\n    }\n  };\n\n  getMdeInstance = () => {\n    if (this.props.getMdeInstance) {\n      this.props.getMdeInstance(this.simpleMde!);\n    }\n  };\n\n  addExtraKeys = () => {\n    // https://codemirror.net/doc/manual.html#option_extraKeys\n    if (this.props.extraKeys) {\n      this.simpleMde!.codemirror.setOption(\"extraKeys\", this.props.extraKeys);\n    }\n  };\n\n  render() {\n    const {\n      events,\n      value,\n      options,\n      children,\n      extraKeys,\n      getLineAndCursor,\n      getMdeInstance,\n      label,\n      onChange,\n      id,\n      ...rest\n    } = this.props;\n    return (\n      <div id={`${this.id}-wrapper`} {...rest} ref={this.setElementWrapperRef}>\n        {label && <label htmlFor={this.id}> {label} </label>}\n        <textarea id={this.id} />\n      </div>\n    );\n  }\n}\n"],"file":"index.js"}