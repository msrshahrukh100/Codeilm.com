{"version":3,"file":"rpc-wrapper.js","sources":["../src/rpc-wrapper.js"],"sourcesContent":["export default function addMethods(worker, methods) {\n\tlet c = 0;\n\tlet callbacks = {};\n\tworker.addEventListener('message', (e) => {\n\t\tlet d = e.data;\n\t\tif (d.type!=='RPC') return;\n\t\tif (d.id) {\n\t\t\tlet f = callbacks[d.id];\n\t\t\tif (f) {\n\t\t\t\tdelete callbacks[d.id];\n\t\t\t\tif (d.error) {\n\t\t\t\t\tf[1](Object.assign(Error(d.error.message), d.error));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tf[0](d.result);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlet evt = document.createEvent('Event');\n\t\t\tevt.initEvent(d.method, false, false);\n\t\t\tevt.data = d.params;\n\t\t\tworker.dispatchEvent(evt);\n\t\t}\n\t});\n\tmethods.forEach( method => {\n\t\tworker[method] = (...params) => new Promise( (a, b) => {\n\t\t\tlet id = ++c;\n\t\t\tcallbacks[id] = [a, b];\n\t\t\tworker.postMessage({ type: 'RPC', id, method, params });\n\t\t});\n\t});\n}\n"],"names":["let"],"mappings":"AAAe,SAAS,WAAW,MAAQ,EAAA,SAAS;IACnDA,IAAI,IAAI;IACRA,IAAI,YAAY;IAChB,MAAA,CAAO,gBAAP,CAAwB,qBAAY;QACnCA,IAAI,IAAI,CAAA,CAAE;QACV,IAAI,CAAA,CAAE,IAAF,KAAS;cAAO;QACpB,IAAI,CAAA,CAAE,IAAI;YACTA,IAAI,IAAI,SAAA,CAAU,CAAA,CAAE;YACpB,IAAI,GAAG;gBACN,OAAO,SAAA,CAAU,CAAA,CAAE;gBACnB,IAAI,CAAA,CAAE,OAAO;oBACZ,CAAA,CAAE,EAAF,CAAK,MAAA,CAAO,MAAP,CAAc,KAAA,CAAM,CAAA,CAAE,KAAF,CAAQ,UAAU,CAAA,CAAE;uBAEzC;oBACJ,CAAA,CAAE,EAAF,CAAK,CAAA,CAAE;;;eAIL;YACJA,IAAI,MAAM,QAAA,CAAS,WAAT,CAAqB;YAC/B,GAAA,CAAI,SAAJ,CAAc,CAAA,CAAE,QAAQ,OAAO;YAC/B,GAAA,CAAI,IAAJ,GAAW,CAAA,CAAE;YACb,MAAA,CAAO,aAAP,CAAqB;;;IAGvB,OAAA,CAAQ,OAAR,WAAiB;QAChB,MAAA,CAAO,OAAP,gBAAiB;;;;mBAAe,IAAI,OAAJ,WAAc,CAAG,EAAA,GAAJ;YAC5CA,IAAI,KAAK,EAAE;YACX,SAAA,CAAU,GAAV,GAAgB,CAAC,EAAG;YACpB,MAAA,CAAO,WAAP,CAAmB;gBAAE,MAAM,KAAR;oBAAe,EAAf;wBAAmB,MAAnB;wBAA2B;;;;;;;;;"}